---
title: 'Azure AD Connect: Migrieren von Gruppen aus einer Gesamtstruktur zu einer anderen | Microsoft-Dokumentation'
description: In diesem Artikel werden die erforderlichen Schritte zum erfolgreichen Migrieren von Gruppen aus einer Gesamtstruktur in eine andere mit Azure AD Connect beschrieben.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 602c60de392afbff18bc141605a936636e48dbfe
ms.sourcegitcommit: ffc6e4f37233a82fcb14deca0c47f67a7d79ce5c
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 04/21/2020
ms.locfileid: "81729700"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrieren von Gruppen aus einer Gesamtstruktur zu einer anderen mit Azure AD Connect

In diesem Artikel werden die erforderlichen Schritte zum erfolgreichen Migrieren von Gruppen aus einer Gesamtstruktur in eine andere beschrieben, sodass die migrierten Gruppenobjekte mit den in der Cloud vorhandenen Objekten übereinstimmen.

## <a name="prerequisites"></a>Voraussetzungen

- Azure AD Connect-Version 1.5.18.0 oder höher
- Das Quellankerattribut ist `mS-DS-ConsistencyGuid`.

Ab Version 1.5.18.0 unterstützt Azure AD Connect die Verwendung von `mS-DS-ConsistencyGuid` für Gruppen. Wenn `mS-DS-ConsistencyGuid` als Quellankerattribut ausgewählt und der Wert in AD aufgefüllt wird, verwendet Azure AD Connect den Wert `mS-DS-ConsistencyGuid` für „immutableId“. Andernfalls wird ein Fallback auf `objectGUID` ausgeführt. Beachten Sie jedoch, dass Azure AD Connect den Wert **NICHT** an das `mS-DS-ConsistencyGuid`-Attribut in AD zurückschreibt.

Während einem gesamtstrukturübergreifenden Verschiebungsszenario, bei dem ein Gruppenobjekt von einer Gesamtstruktur (z. B. F1) in eine andere Gesamtstruktur (z. B. F2) verschoben wird, muss entweder der `mS-DS-ConsistencyGuid`-Wert (sofern vorhanden) oder der `objectGUID`-Wert des Objekts in der Gesamtstruktur F1 in das `mS-DS-ConsistencyGuid`-Attribut des Objekts in der Gesamtstruktur F2 kopiert werden. 

Für die Migration einer einzelnen Gruppe aus der Gesamtstruktur F1 in die Gesamtstruktur F2 können Sie sich an den folgenden Skripts orientieren. Diese Skripts können auch als Richtlinie für die Migration mehrerer Gruppen dienen.

Zunächst werden die Werte `objectGUID` und `mS-DS-ConsistencyGuid` des Gruppenobjekts in der Gesamtstruktur F1 abgerufen. Diese Attribute werden in eine CSV-Datei exportiert.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Anschließend verwenden Sie die generierte CSV-Ausgabedatei, um das `mS-DS-ConsistencyGuid`-Attribut für das Zielobjekt in der Gesamtstruktur F2 zu stempeln.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Nächste Schritte
Weitere Informationen zum [Integrieren lokaler Identitäten in Azure Active Directory](whatis-hybrid-identity.md).
