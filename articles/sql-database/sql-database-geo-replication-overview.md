<properties
	pageTitle="Aktive Georeplikation für Azure SQL-Datenbank"
	description="In diesem Thema werden die aktive Georeplikation für Azure SQL-Datenbank und ihre Zwecke erklärt."
	services="sql-database"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar" />


<tags
	ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="03/07/2016"
	ms.author="jroth" />

# Aktive Georeplikation für Azure SQL-Datenbank

## Übersicht
Das Feature „Aktive Georeplikation“ implementiert einen Mechanismus zum Bereitstellen von Datenbankredundanz innerhalb derselben Microsoft Azure-Region bzw. verschiedenen Regionen (Georedundanz). Bei aktiver Georeplikation werden Transaktionen mit ausgeführtem Commit aus einer Datenbank bis zu vier Kopien der Datenbank auf verschiedene Server asynchron repliziert. Wenn die aktive Georeplikation konfiguriert ist, wird auf dem angegebenen Server eine sekundäre Datenbank erstellt. Die ursprüngliche Datenbank wird zur primären Datenbank. Die primäre Datenbank repliziert Transaktionen mit ausgeführtem Commit asynchron in alle sekundären Datenbanken. Wenngleich die sekundäre Datenbank stets ein wenig hinter der primären Datenbank zurückliegt, wird garantiert, dass die sekundären Daten im Hinblick auf Transaktionen stets konsistent mit Änderungen sind, für die in der primären Datenbank ein Commit erfolgt ist.

Einer der Hauptvorteile der aktiven Georeplikation ist, dass es sich um eine Lösung für die Notfallwiederherstellung auf Datenbankebene handelt, die eine sehr geringe Wiederherstellungszeit erfordert. Wenn Sie die sekundäre Datenbank auf einem Server in einer anderen Region platzieren, stellen Sie die maximale Resilienz (Ausfallsicherheit) Ihrer Anwendung sicher. Die regionsübergreifende Redundanz ermöglicht Anwendungen die Wiederherstellung nach einem dauerhaften Ausfall eines gesamten Rechenzentrums oder von Teilen eines Rechenzentrums aufgrund von Naturkatastrophen, schwerwiegendem menschlichen Versagen oder böswilligen Handlungen. Die folgende Abbildung zeigt ein Beispiel für die Konfiguration der aktiven Georeplikation für eine Premium-Datenbank, wobei sich die primäre Datenbank in der Region „USA, Westen“ und die sekundäre Datenbank in der Region „USA, Osten“ befindet.

![Georeplikationsbeziehung](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

Ein anderer wichtiger Vorteil ist, dass die sekundären Datenbanken lesbar sind und zum Auslagern schreibgeschützter Workloads wie Berichtsaufträge verwendet werden können. Wenn Sie die sekundäre Datenbank nur für den Lastenausgleich verwenden möchten, können Sie sie in der gleichen Region wie die primäre Datenbank erstellen. Auf diese Weise wird jedoch nicht die Resilienz der Anwendung gegenüber schwerwiegenden Fehlern erhöht.

Es folgen weitere Szenarien, in denen die aktive Georeplikation verwendet werden kann:

- **Datenbankmigration**: Sie können die aktive Georeplikation zur Onlinemigration einer Datenbank von einem Server auf einen anderen bei minimalen Ausfallzeiten nutzen.
- **Anwendungsupgrades:** Sie können eine zusätzliche sekundäre Datenbank als Failbackkopie bei Anwendungsupgrades erstellen.

Wenn Sie echte Geschäftskontinuität erreichen möchten, ist das Bereitstellen von Datenbankredundanz zwischen Rechenzentren jedoch nur ein Teil der Lösung. Für die komplette Wiederherstellung einer Anwendung bzw. eines Diensts nach einem schwerwiegenden Fehler ist das Wiederherstellen aller Komponenten erforderlich, aus denen sich der Dienst und alle abhängigen Dienste zusammensetzen. Beispiele dieser Komponenten sind die Clientsoftware (z. B. ein Browser mit benutzerdefiniertem JavaScript), Web-Front-Ends, Speicher und DNS. Es ist wichtig, dass alle Komponenten hinsichtlich derselben Fehler gegen Ausfälle geschützt und innerhalb des RTO (Recovery Time Objective) der Anwendung wieder verfügbar sind. Daher müssen Sie alle abhängigen Dienste bestimmen und mit dem Leistungsumfang und den Funktionen vertraut sein, die sie bieten. Dann müssen Sie entsprechende Maßnahmen ergreifen, um sicherzustellen, dass Ihr Dienst während des Failovers der Dienste funktioniert, von denen er abhängig ist. Weitere Informationen zum Entwerfen von Lösungen für die Notfallwiederherstellung finden Sie unter [Entwerfen von Cloudlösungen für die Notfallwiederherstellung mithilfe der aktiven Georeplikation](sql-database-designing-cloud-solutions-for-disaster-recovery.md).

## Möglichkeiten der aktiven Georeplikation
Das Feature „Aktive Georeplikation“ bietet die folgenden wichtigen Möglichkeiten:

- **Automatische asynchrone Replikation:** Sie können eine sekundäre Datenbank nur durch Hinzufügen zu einer vorhandenen Datenbank erstellen. Die sekundäre Datenbank kann nur auf einem anderen Azure SQL-Datenbank-Server erstellt werden. Nach der Erstellung wird die sekundäre Datenbank mit den Daten aufgefüllt, die aus der primären Datenbank kopiert wurden. Dieser Prozess wird als Seeding bezeichnet. Nachdem eine sekundäre Datenbank erstellt wurde und das Seeding erfolgt ist, werden Aktualisierungen der primären Datenbank automatisch asynchron in die sekundäre Datenbank repliziert. Dies bedeutet, dass für Transaktionen in der primären Datenbank ein Commit erfolgt, ehe sie in die sekundäre Datenbank repliziert werden. SQL-Datenbank garantiert, dass die sekundäre Datenbank nach Abschluss des Seedings im Hinblick auf Transaktionen zu jeder Zeit konsistent bleibt. Weitere Informationen zum Erstellen der sekundären Datenbank finden Sie unter [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit Transact-SQL](sql-database-geo-replication-transact-sql.md) und [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit PowerShell](sql-database-geo-replication-powershell.md). Ausführliche Informationen zum Erstellen der sekundären Datenbank mithilfe des Azure-Portals finden Sie unter [Konfigurieren der Georeplikation für die Azure SQL-Datenbank mit dem Azure-Portal](sql-database-geo-replication-portal.md).

- **Mehrere sekundäre Datenbanken:** Mehrere sekundäre Datenbanken sorgen für mehr Redundanz und Schutz für die primäre Datenbank und Anwendung. Wenn mehrere sekundäre Datenbanken vorhanden sind, bleibt die Anwendung auch bei Ausfall einer der sekundären Datenbanken geschützt. Wenn es nur eine sekundäre Datenbank gibt und diese ausfällt, ist die Anwendung bis zum Erstellen einer neuen sekundären Datenbank einem höheren Risiko ausgesetzt.

- **Lesbare sekundäre Datenbanken:** Eine Anwendung kann für schreibgeschützte Vorgänge auf eine sekundäre Datenbank zugreifen, indem sie dieselben oder andere Sicherheitsprinzipale als für den Zugriff auf die primäre Datenbank verwendet. Die sekundären Datenbanken werden im Momentaufnahme-Isolationsmodus betrieben. Auf diese Weise wird sichergestellt, dass die Replikation von Aktualisierungen der primären Datenbank (Protokollwiedergabe) nicht durch Abfragen verzögert wird, die für die sekundäre Datenbank ausgeführt werden.

>[AZURE.NOTE] Die Protokollwiedergabe wird in der sekundären Datenbank verzögert, wenn Schemaaktualisierungen vorhanden sind, die die Datenbank von der primären Datenbank erhält, da eine Schemasperre für die sekundäre Datenbank erforderlich ist.

- **Aktive Georeplikation von elastischen Pooldatenbanken:** Die aktive Georeplikation kann für jede Datenbank in einem Premium-Pool für elastische Datenbanken konfiguriert werden. Die sekundäre Datenbank kann sich in einem anderen Premium-Pool für elastische Datenbanken befinden. Für normale Datenbanken kann die sekundäre Datenbank ein Pool für elastische Datenbanken sein und umgekehrt, sofern die Dienstebenen identisch sind. Weitere Informationen zum Konfigurieren der Georeplikation für den Pool für elastische Datenbanken finden Sie unter [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit Transact-SQL](sql-database-geo-replication-transact-sql.md) und [Konfigurieren der Georeplikation für die Azure SQL-Datenbank mit PowerShell](sql-database-geo-replication-powershell.md).  

- **Konfigurierbare Leistungsstufe der sekundären Datenbank:** Eine sekundäre Datenbank kann mit einer niedrigeren Leistungsstufe als die primäre Datenbank erstellt werden. Sowohl die primäre als auch die sekundäre Datenbank müssen die gleiche Dienstebene aufweisen. Diese Option wird nicht für Anwendungen mit Datenbanken empfohlen, die eine hohe Schreibaktivität aufweisen, da dies zu größeren Replikationsverzögerungen führen kann. In diesem Fall besteht ein hohes Risiko, dass es nach einem Failover zu erheblichen Datenverlusten kommt. Darüber hinaus wird nach einem Failover die Leistung der Anwendung beeinträchtigt, bis die neue primäre Datenbank auf eine höhere Leistungsstufe aktualisiert wurde. Das Diagramm mit dem Protokoll-E/A-Prozentsatz im Azure-Portal bietet eine gute Möglichkeit einzuschätzen, welche Leistungsstufe für die sekundäre Datenbank mindestens erforderlich ist, um die Replikationslast zu bewältigen. Wenn die Leistungsstufe der primären Datenbank beispielsweise P6 (1.000 DTU) ist und ihr Protokoll-E/A-Prozentsatz 50 % beträgt, muss die Leistungsstufe der sekundären Datenbank mindestens P4 (500 DTU) sein. Sie können die Protokoll-E/A-Daten auch mithilfe der Datenbankansichten [sys.resource\_stats](https://msdn.microsoft.com/library/dn269979.aspx) oder [sys.dm\_db\_resource\_stats](https://msdn.microsoft.com/library/dn800981.aspx) abrufen. Weitere Informationen zu den SQL-Datenbank-Leistungsstufen finden Sie unter [SQL-Datenbankoptionen und -leistung](sql-database-service-tiers.md). Weitere Informationen zum Konfigurieren der Leistungsstufe für die sekundären Datenbankbeispiele finden Sie unter [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit Transact-SQL](sql-database-geo-replication-transact-sql.md) und [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit PowerShell](sql-database-geo-replication-powershell.md).

- **Benutzergesteuertes Failover und Failback:** Eine sekundäre Datenbank kann jederzeit über eine explizite Aktion durch die Anwendung oder den Benutzer auf die primäre Rolle umgeschaltet werden. Bei einem echten Ausfall sollte die Option „Nicht geplant“ verwendet werden, die eine sekundäre Datenbank umgehend zu einer primären Datenbank heraufstuft. Wenn die ausgefallene primäre Datenbank wiederhergestellt wurde und wieder zur Verfügung steht, wird sie vom System automatisch als sekundäre Datenbank gekennzeichnet und auf den aktuellen Stand der neuen primären Datenbank gebracht. Aufgrund der asynchronen Natur der Replikation kann eine kleine Menge von Daten bei einem nicht geplanten Failover verloren gehen, wenn eine primäre Datenbank ausfällt, bevor die aktuellen Änderungen in die sekundäre Datenbank repliziert wurden. Wenn für eine primäre Datenbank mit mehreren sekundären Datenbanken ein Failover durchgeführt wird, konfiguriert das System automatisch die Replikationsbeziehungen neu und verknüpft die verbleibenden sekundären Datenbanken mit der soeben heraufgestuften primären Datenbank, ohne dass ein Benutzereingriff erforderlich ist. Wenn der Ausfall behoben ist, durch den das Failover verursacht wurde, kann es wünschenswert sein, die Anwendung wieder in die primäre Region zu zurückzuführen. Zu diesem Zweck sollte der Failoverbefehl mit der Option „Geplant“ aufgerufen werden. Weitere Informationen zum Aktivieren des Failovers mit T-SQL finden Sie unter [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit Transact-SQL](sql-database-geo-replication-transact-sql.md). Weitere Informationen zum Aktivieren des Failovers mit PowerShell finden Sie unter [Konfigurieren der Georeplikation für Azure SQL-Datenbank mit PowerShell](sql-database-geo-replication-powershell.md).

- **Synchronisieren von Anmeldeinformationen und Firewallregeln:** Wir empfehlen die Verwendung von [Datenbank-Firewallregeln](sql-database-firewall-configure.md) für georeplizierte Datenbanken, damit diese Regeln mit der Datenbank repliziert werden können. So wird sichergestellt, dass alle sekundären Datenbanken die gleiche Firewallkonfiguration wie die primäre Datenbank aufweisen. Auf diese Weise müssen Kunden auf Servern, auf denen sowohl die primäre als auch die sekundäre Datenbank gehostet wird, keine Firewallregeln mehr manuell konfigurieren und verwalten. In ähnlicher Weise wird durch die Verwendung von [eigenständigen Datenbankbenutzern](sql-database-manage-logins.md) für den Datenzugriff sichergestellt, dass für primäre und sekundäre Datenbanken immer die gleichen Benutzeranmeldeinformationen gelten, damit bei einem Failover keine Unterbrechungen aufgrund von Benutzernamen- und Kennwortkonflikten auftreten. Durch das Hinzufügen von [Azure Active Directory](../active-directory/active-directory-whatis.md) können Kunden den Benutzerzugriff sowohl für primäre als auch für sekundäre Datenbanken verwalten, sodass die Notwendigkeit der Verwaltung von Anmeldeinformationen in Datenbanken vollständig entfällt.

- **Azure Resource Manager-API und rollenbasierte Sicherheit:** Aktive Georeplikation umfasst eine Reihe von [Azure Resource Manager (ARM)-APIs](https://msdn.microsoft.com/library/azure/mt163571.aspx) für die Verwaltung, einschließlich [ARM-basierter PowerShell-Cmdlets](sql-database-geo-replication-powershell.md). Diese APIs erfordern die Verwendung von Ressourcengruppen und unterstützen rollenbasierte Sicherheit (RBAC). Weitere Informationen zur Implementierung von Zugriffsrollen finden Sie unter [Rollenbasierte Access Control in Azure](../active-directory/role-based-access-control-configure.md).

>[AZURE.NOTE] Die vorhandene [Azure SQL-Dienstverwaltungs-REST-API (klassisch)](https://msdn.microsoft.com/library/azure/dn505719.aspx) sowie [Azure SQL-Datenbank-Cmdlets (klassisch)](https://msdn.microsoft.com/library/azure/dn546723.aspx) werden für die Abwärtskompatibilität unterstützt. Viele neue Features für die aktive Georeplikation werden jedoch nur in der ARM-basierten [Azure SQL-REST-API](https://msdn.microsoft.com/library/azure/mt163571.aspx) und in den ARM-basierten [Azure SQL-Datenbank-PowerShell-Cmdlets](https://msdn.microsoft.com/library/azure/mt574084.aspx) unterstützt.

## Verhindern des Verlusts wichtiger Daten
Aufgrund der hohen Latenz von WANs wird für die fortlaufende Kopie ein asynchroner Replikationsmechanismus verwendet. Dadurch wird Datenverlust unvermeidlich, sobald ein Ausfall auftritt. Bei einigen Anwendung dürfen jedoch ggf. keine Daten verloren gehen. Um diese kritischen Aktualisierungen zu schützen, kann ein Anwendungsentwickler die Systemprozedur [sp\_wait\_for\_database\_copy\_sync](https://msdn.microsoft.com/library/dn467644.aspx) aufrufen, unmittelbar nachdem der Commit für die Transaktion erfolgt ist. Das Aufrufen von **sp\_wait\_for\_database\_copy\_sync** blockiert den aufrufenden Thread so lange, bis die letzte Transaktion mit erfolgtem Commit in die sekundäre Datenbank repliziert wurde. Die Prozedur wartet, bis alle in der Warteschlange befindlichen Transaktionen von der sekundären Datenbank bestätigt wurden. **sp\_wait\_for\_database\_copy\_sync** ist auf eine bestimmte fortlaufende Kopierverknüpfung begrenzt. Jeder Benutzer mit den Rechten zum Herstellen der Verbindung mit der primären Datenbank kann diese Prozedur aufrufen.

>[AZURE.NOTE] Die Verzögerung durch einen Aufruf der Prozedur **sp\_wait\_for\_database\_copy\_sync** kann erheblich sein. Die Verzögerung hängt von der aktuellen Größe des Transaktionsprotokolls ab, und es erfolgt erst dann eine Rückgabe, wenn das gesamte Protokoll repliziert wurde. Vermeiden Sie den Aufruf dieser Prozedur, es sei denn, er ist unbedingt erforderlich.

## Nächste Schritte
Weitere Informationen zu zusätzlichen Geschäftskontinuitätsfeatures von SQL-Datenbank finden Sie unter [Geschäftskontinuität – Übersicht](sql-database-business-continuity.md).

<!---HONumber=AcomDC_0309_2016-->